### å¦‚ä½•è§£å†³å®‰è£…æ¨¡æ¿æ—¶æ§åˆ¶å°åŠ¨ç”»é—ªçƒé—®é¢˜



**åŸå› åˆ†æï¼š**

â€‹	åœ¨æˆ‘ä»¬ä½¿ç”¨cli-spinnerç»™æˆ‘ä»¬çš„è„šæ‰‹æ¶æ·»åŠ è‡ªå·±çš„å®‰è£…åŠ¨ç”»æ—¶ï¼Œç”±äºæˆ‘ä»¬ä½¿ç”¨äº†npminstallä½œä¸ºæˆ‘ä»¬å®‰è£…npmåŒ…çš„ä¾èµ–ï¼Œnpminstallæœ¬èº«åœ¨å®‰è£…åŒ…çš„æ—¶å€™å°±æœ‰å®‰è£…åŠ¨ç”»ã€‚æ‰€ä»¥æˆ‘ä»¬è‡ªå·±ç»™è„šæ‰‹æ¶æ·»åŠ çš„åŠ¨ç”»å’Œnpminstallå†…ç½®çš„æœ‰å†²çªï¼Œå¯¼è‡´æ§åˆ¶å°äº¤æ›¿è¾“å‡ºï¼Œä»è€Œå¯¼è‡´é—ªçƒã€‚åç»­æ€è·¯ä¸ºå»æ‰npminstallåŠ¨ç”»å‡ºå‘ï¼Œä¿ç•™æˆ‘ä»¬è‡ªå·±çš„åŠ¨ç”»ä¸ºç›®çš„è¿›è¡Œã€‚



**æ­¥éª¤ä¸€ï¼š**

â€‹	æŸ¥çœ‹npminstallé…ç½®ï¼Œæ˜¯å¦æœ‰å»æ‰åŠ¨ç”»é…ç½®ã€‚é€šè¿‡æŸ¥çœ‹ä½¿ç”¨è¯´æ˜ï¼Œæœªèƒ½æ‰¾åˆ°å¯¹åº”çš„é…ç½®ã€‚

````javascript
await npminstall({
    // install root dir
    root: process.cwd(),
    // optional packages need to install, default is package.json's dependencies and devDependencies
    // pkgs: [
    //   { name: 'foo', version: '~1.0.0' },
    // ],
    // install to specific directory, default to root
    // targetDir: '/home/admin/.global/lib',
    // link bin to specific directory (for global install)
    // binDir: '/home/admin/.global/bin',
    // registry, default is https://registry.npmjs.org
    // registry: 'https://registry.npmjs.org',
    // debug: false,
    // storeDir: root + 'node_modules',
    // ignoreScripts: true, // ignore pre/post install scripts, default is `false`
    // forbiddenLicenses: forbit install packages which used these licenses
  });
````



**æ­¥éª¤äºŒï¼š**

â€‹	å› ä¸ºæ²¡æœ‰æ–‡æ¡£è¯´æ˜å¦‚ä½•å»æ‰ï¼Œäºæ˜¯å»ç¿»çœ‹æºç ï¼ŒæŸ¥çœ‹local_install.jsæ–‡ä»¶ï¼Œæ‰¾åˆ°é»˜è®¤åŠ¨ç”»ç›¸å…³æ ¸å¿ƒä»£ç å¦‚ä¸‹

local_install.js

````javascript
module.exports = async options => {
  options = formatInstallOptions(options);
  options.spinner && options.spinner.start();
	...
}
````

format_install_options.js

````javascript
module.exports = function formatInstallOptions(options) {
  options.trace = !!options.trace;
  if (options.trace) {
    // make sure detail enable when trace enable
    options.detail = true;
  }

  options.spinner = options.detail ? null : ora();
	...
}
````

é€šè¿‡åˆ†æä»£ç å‘ç°å’Œé»˜è®¤å®‰è£…åŠ¨ç”»ç›¸å…³çš„åˆ†åˆ«ä¸ºä¸¤ä¸ªåœ¨æ–‡æ¡£ä¸­æœªæåŠçš„å‚æ•°traceã€detailï¼Œå’Œoraæ–¹æ³•ï¼Œå…¶ä¸­oraæ–¹æ³•å†…éƒ¨å¯¹cli-spinneråŠ¨ç”»è¿›è¡Œäº†å°è£…ï¼Œæ‰€ä»¥å½“detailä¸ºtrueçš„æ—¶å€™options.spinnerä¸ºnullï¼Œè€Œoptions.spinnerå¼•ç”¨ç€ä¸€ä¸ªcli-spinnerä¸­Spinnerçš„å®ä¾‹ï¼Œå½“options.spinnerä¸ºnullæ—¶ï¼Œè¿™ä¸ªæ—¶å€™å°†æ²¡æœ‰åŠ¨ç”»ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨æ‰§è¡Œnpminstallæ–¹æ³•çš„æ—¶å€™ä¼ å…¥detailä¸ºtrueï¼Œå¦‚ï¼š**npminstall({detail:true})**ä»è€Œè¾¾åˆ°æˆ‘ä»¬å¸Œæœ›å»æ‰npminstallåŠ¨ç”»çš„ç›®çš„ã€‚éœ€è¦æ³¨æ„çš„æ˜¯å¦‚æœæˆ‘ä»¬éœ€è¦npminstallçš„é»˜è®¤å®‰è£…åŠ¨ç”»ï¼Œæˆ‘ä»¬ä¸èƒ½åœ¨æ‰§è¡Œnpminstallæ–¹æ³•çš„æ—¶å€™ä¼ å…¥traceä¸ºtrueï¼Œå¦åˆ™ä¼ å…¥çš„detailå°†ä¼šè¢«è¦†ç›–ä¸ºtrueã€‚



**æ­¥éª¤ä¸‰ï¼š**

â€‹	æµ‹è¯• trace=falseï¼Œæœ‰åŠ è½½åŠ¨ç”»ï¼Œæ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹

````shell
âœ” Installed 1 packages
âœ” Linked 1 latest versions
âœ” Run 0 scripts
âœ” All packages installed (1 packages installed from npm registry, used 631ms(network 630ms), speed 6.18KB/s, json 1(3.9KB), tarball 0B)
````

æµ‹è¯• trace=trueï¼Œnpminstallä»£ç å†…éƒ¨ä¼šå°†options.detail=trueæ­¤æ—¶æ— åŠ è½½åŠ¨ç”»ï¼Œæ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹

````shell
[1/1] imooc-cli-dev-template-vue2@1.0.0 installed at node_modules/_imooc-cli-dev-template-vue2@1.0.0@imooc-cli-dev-template-vue2
All packages installed (1 packages installed from npm registry, used 453ms(network 451ms), speed 8.64KB/s, json 1(3.9KB), tarball 0B)
[trace] 454ms ğŸŠ  memory usage, rss: 50.16MB, heapTotal: 31.02MB, heapUsed: 16.84MB, external: 1.56MB; ğŸ’»  os free: 41.12MB, os load: 4.5, 5.1, 5.3; ğŸƒ  cpu usage, user: 0, system: 0

````



é€šè¿‡è®¾ç½®detailä¸ºtrueåŠ¨ç”»æ˜¯å¯ä»¥å»æ‰äº†ï¼Œä½†æ˜¯å®‰è£…ä¿¡æ¯ä»»ç„¶å­˜åœ¨ï¼Œé€šè¿‡æŸ¥çœ‹ä»£ç å‘ç°æœ€ç»ˆç»“æœæ—¥å¿—åœ¨local_install.js 569è¡Œæ‰“å°ã€‚ä»£ç å¦‚ä¸‹

````javascript
  if (options.spinner) {
    options.spinner.succeed(util.format(...logArguments));
  } else {
    options.console.info(...logArguments);
  }
````

æ€è€ƒï¼šå¦‚ä½•è®©npminstallä¿æŒæ²‰é»˜ï¼Œä¸è¾“å‡ºä»»ä½•ä¿¡æ¯ï¼Ÿ

æ–¹å¼ä¸€ï¼š

â€‹	æ”¹local_install.jsæºç ï¼Œæ‰‹åŠ¨æ”¹è‚¯å®šæ˜¯ä¸è¡Œçš„ï¼Œå¯å¦è„šæ‰‹æ¶ä»£ç æ›´æ”¹ï¼Ÿå› ä¸ºjsæ˜¯åŠ¨æ€è¯­è¨€/è§£é‡Šæ‰§è¡Œï¼Œå®é™…ä¸Šé€šè¿‡æ‰¾åˆ°npminstallåŒ…ï¼Œç„¶åæ‰¾åˆ°local_install.jsï¼Œé€šè¿‡nodejsæä¾›çš„æ–‡ä»¶è¯»å†™èƒ½åŠ›å¹²æ‰ä»¥ä¸Šä»£ç åº”è¯¥å¯è¡Œã€‚ç»†æ€ææå•Šï¼ï¼ï¼

